/* styles/helpers.css — micro-утилиты без визуала */

/* ── Home hero paddings & anchor offsets (with dvh fallbacks) */
:root{
  --home-hero-pt-min: 8px;

  /* ↑ ещё опускаем панель: было 8/12 → стало 10/16 */
  --home-hero-pt-ideal: 18vh;
  --home-hero-pt-max: 24vh;

  --home-hero-pb-min: 6px;
  --home-hero-pb-ideal: 1.25vh; /* было 2.5vh */
  --home-hero-pb-max: 2vh;      /* было 4vh */

  /* Anchor offsets (vh defaults) */
  --anchor-offset-top: 12vh;
  --anchor-offset-bottom: 14vh;

  /* Short viewport adjustments */
  --anchor-offset-top-short: 14vh;
  --anchor-offset-bottom-short: 16vh;

  /* фикс-хедер и небольшой “breathing room” */
  --header-h: 80px;
  --anchor-top-extra: 8px;
}

/* dvh — только при поддержке (iOS 16.4+/modern WebViews) */
@supports (height: 100dvh){
  :root{
    --home-hero-pt-ideal: 18dvh;
    --home-hero-pt-max: 24dvh;

    --home-hero-pb-ideal: 1.25dvh;
    --home-hero-pb-max: 2dvh;

    --anchor-offset-top: 12dvh;
    --anchor-offset-bottom: 14dvh;

    --anchor-offset-top-short: 14dvh;
    --anchor-offset-bottom-short: 16dvh;
  }
}

@layer components {
  .home-hero-foreground{
    margin-top: clamp(var(--home-hero-pt-min), var(--home-hero-pt-ideal), var(--home-hero-pt-max));
    margin-bottom: clamp(var(--home-hero-pb-min), var(--home-hero-pb-ideal), var(--home-hero-pb-max));
  }

  /* Фолбэк для старых движков: просто vh-значение */
  .section-anchor-offset{
    scroll-margin-top: 14vh;
    scroll-margin-bottom: var(--anchor-offset-bottom);
  }

  /* Если доступен max() — никогда не ниже высоты хедера */
  @supports (scroll-margin-top: max(1px, 1vh)){
    .section-anchor-offset{
      scroll-margin-top: max(calc(var(--header-h) + var(--anchor-top-extra)), 14vh);
    }
  }
}

/* контейнер hero: меньше экрана и адаптивно */
@layer components{
  .home-hero-container{ min-height: 88vh; }
}
@supports (height: 100dvh){
  @layer components{
    .home-hero-container{ min-height: 88dvh; }
  }
}

/* Очень низкие вьюпорты: увеличиваем запас сверху/снизу */
@layer components{
  @media (max-height: 700px){
    /* фолбэк */
    .section-anchor-offset{
      scroll-margin-top: 16vh;
      scroll-margin-bottom: var(--anchor-offset-bottom-short);
    }
    /* надёжная защита “не ниже хедера” */
    @supports (scroll-margin-top: max(1px, 1vh)){
      .section-anchor-offset{
        scroll-margin-top: max(calc(var(--header-h) + var(--anchor-top-extra)), 16vh);
      }
    }
  }
}

/* dvh-ветка (динамическая высота) */
@supports ((height: 100dvh) and (scroll-margin-top: max(1px, 1vh))){
  @layer components{
    .section-anchor-offset{
      scroll-margin-top: max(calc(var(--header-h) + var(--anchor-top-extra)), 14dvh);
    }
  }
}

/* dvh-вариант для коротких экранов */
@supports ((height: 100dvh) and (scroll-margin-top: max(1px, 1vh))){
  @layer components{
    @media (max-height: 700px){
      .section-anchor-offset{
        scroll-margin-top: max(calc(var(--header-h) + var(--anchor-top-extra)), 16dvh);
      }
    }
  }
}

/* Hero: адаптивный верхний внешний отступ (margin-top) для коротких экранов */
@media (max-height: 700px){
  :root{
    --home-hero-pt-ideal: 10vh;
    --home-hero-pt-max:   14vh;
  }
}
@supports (height: 100dvh){
  @media (max-height: 700px){
    :root{
      --home-hero-pt-ideal: 10dvh;
      --home-hero-pt-max:   14dvh;
    }
  }
}

@media (max-height: 600px){
  :root{
    --home-hero-pt-ideal: 8vh;
    --home-hero-pt-max:   12vh;
  }
}
@supports (height: 100dvh){
  @media (max-height: 600px){
    :root{
      --home-hero-pt-ideal: 8dvh;
      --home-hero-pt-max:   12dvh;
    }
  }
}

@layer components {
  /* Полностью прозрачный «щит» для контента:
     отключает blur/filters/blend родителя и изолирует стек. */
  .content-contrast-reset {
    background-color: transparent !important;
    background-image: none !important;
    filter: none !important;
    mix-blend-mode: normal !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    isolation: isolate !important;
    position: relative; /* помогает с z-index при необходимости */
  }
}

@layer utilities {
  .font-ui-role {
    font-family: var(--font-ui, system-ui), -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  .font-brand-role {
    font-family: var(--font-brand, var(--font-ui, system-ui)), -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  .font-serif-role {
    font-family: var(--font-serif, Georgia, "Times New Roman", Times, serif);
  }
  .font-mono-role {
    font-family: var(--font-mono, ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace);
  }
}
